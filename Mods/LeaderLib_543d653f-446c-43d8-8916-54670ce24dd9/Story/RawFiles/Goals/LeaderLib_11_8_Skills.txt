Version 1
SubGoalCombiner SGC_AND
INITSECTION
//LeaderLib_Skills_InitSettings();

KBSECTION
//REGION SETTINGS
/*
PROC
LeaderLib_Skills_InitSettings()
THEN
DB_NOOP(1);

PROC
LeaderUpdater_ModUpdated("LeaderLib", "LaughingLeader", (STRING)_PastVersion, (STRING)_NewVersion)
AND
LeaderLib_StringExt_QRY_VersionIsLessThan(_PastVersion, 1, 1, 4, 2)
THEN
LeaderLib_Skills_InitSettings();
*/
//END_REGION

//REGION SUMMON_CONTROL
IF
CharacterUsedSkillOnTarget(_Player, (CHARACTERGUID)_Summon, "Target_LeaderLib_ControlSummon", _, _)
AND
CharacterIsSummon(_Summon, 1)
AND
CharacterGetOwner(_Summon, _Player)
THEN
MakePlayerActive(_Summon);

IF
CharacterUsedSkillOnTarget(_Player, (CHARACTERGUID)_Follower, "Target_LeaderLib_ControlSummon", _, _)
AND
CharacterIsSummon(_Follower, 0)
AND
IsTagged(_Follower, "LeaderLib_IsFollower", 1)
AND
CharacterGetOwner(_Follower, _Player)
THEN
MakePlayerActive(_Follower);
//END_REGION

//REGION FORCE_SAFETY_CHECK
IF
CharacterStatusAttempt(_Character, "LEADERLIB_FORCE_APPLIED", _)
AND
GetPosition(_Character, _x, _y, _z)
AND
NOT DB_LeaderLib_Skills_Temp_CheckForcePosition(_Character, _, _, _)
THEN
DB_LeaderLib_Skills_Temp_CheckForcePosition(_Character, _x, _y, _z);

IF
CharacterStatusRemoved(_Character, "SHOCKWAVE", _)
AND
DB_LeaderLib_Skills_Temp_CheckForcePosition(_Character, _StartX, _StartY, _StartZ)
AND
GetPosition(_Character, _ForceX, _ForceY, _ForceZ)
AND
NOT FindValidPosition(_ForceX, _ForceY, _ForceZ, 10.0, _Character, _, _, _)
AND
CreateItemTemplateAtPosition("LOOT_LeaderLib_BackPack_Invisible_98fa7688-0810-4113-ba94-9a8c8463f830", _StartX, _StartY, _StartZ, _PositionChecker)
THEN
NOT DB_LeaderLib_Skills_Temp_CheckForcePosition(_Character, _StartX, _StartY, _StartZ);
LeaderLog_Log("DEBUG", "[LeaderLib:Skills:ForcePositionCorrection] Character was moved with Force and is not in a valid position. Spawning item and attempting to find a valid position.");
DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _StartX, _StartY, _StartZ);
ProcObjectTimer(_PositionChecker, "LeaderLib_Timers_PositionChecker_ValidatePosition", 25);
ItemMoveToPosition(_PositionChecker, _ForceX, _ForceY, _ForceZ, 5.0, 0.0, "LeaderLib_Events_Skills_ForcePositionFinderDone", 1);

IF
ItemMoved(_PositionChecker)
AND
DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _StartX, _StartY, _StartZ)
THEN
SetStoryEvent(_PositionChecker, "LeaderLib_Events_Skills_ForcePositionFinderDone");

PROC
ProcObjectTimerFinished((ITEMGUID)_PositionChecker, "LeaderLib_Timers_PositionChecker_ValidatePosition")
AND
DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _x, _y, _z)
AND
GetPosition(_PositionChecker, _ix, _iy, _iz)
AND
FindValidPosition(_ix, _iy, _iz, 10.0, _Character, _vx, _vy, _vz)
THEN
NOT DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _x, _y, _z);
DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _vx, _vy, _vz);
ProcObjectTimer(_PositionChecker, "LeaderLib_Timers_PositionChecker_ValidatePosition", 25);

IF
StoryEvent((ITEMGUID)_PositionChecker, "LeaderLib_Events_Skills_ForcePositionFinderDone")
AND
DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _x, _y, _z)
THEN
NOT DB_LeaderLib_Skills_Temp_PositionChecker_LastValidSpot(_Character, _PositionChecker, _x, _y, _z);
ProcObjectTimerCancel(_PositionChecker, "LeaderLib_Timers_PositionChecker_ValidatePosition");
ItemRemove(_PositionChecker);
LeaderLog_Log("DEBUG", "[LeaderLib:Skills:ForcePositionCorrection] Valid position found by item. Teleporting character to position.");
TeleportToPosition(_Character, _x, _y, _z, "LeaderLib_Events_ForcePositionCorrected", 0, 1);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LeaderLib_11__Start"
